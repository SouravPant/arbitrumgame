<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=390, initial-scale=1.0" />
    <title>Arbitrum Game - Farcaster Mini App</title>

    <!-- Farcaster Mini App Metadata -->
    <meta name="fc:miniapp" content='{
      "version": "1",
      "imageUrl": "https://arbitrumgame.vercel.app/image.png",
      "button": {
        "title": "Play Game",
        "action": {
          "type": "launch_frame",
          "name": "ArbitrumGame",
          "url": "https://arbitrumgame.vercel.app",
          "splashImageUrl": "https://arbitrumgame.vercel.app/splash.png",
          "splashBackgroundColor": "#667eea"
        }
      }
    }' />

    <style>
      body {
        margin: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: space-between;
        min-height: 100vh;
        padding: 16px;
        box-sizing: border-box;
        text-align: center;
      }

      .header {
        width: 100%;
        max-width: 390px;
        display: flex;
        justify-content: space-between;
        font-size: 1rem;
        font-weight: bold;
        padding: 0 12px;
      }

      .game-area {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .game-button {
        width: 160px;
        height: 160px;
        border-radius: 50%;
        background: white;
        border: 4px solid white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        transition: transform 0.2s;
      }

      .game-button:hover {
        transform: scale(1.1);
      }

      .stats {
        font-size: 1.2rem;
        margin: 6px 0;
      }

      .status {
        padding: 10px 20px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        font-size: 0.9rem;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div id="gameStatus">Status: Loading...</div>
      <div id="sdkStatus">SDK: ...</div>
    </div>

    <div class="game-area">
      <h1>ðŸŽ® Arbitrum Game</h1>
      <p>Farcaster Mini App Test</p>
      
      <div class="game-button" id="gameButton">
        ðŸŽ¯
      </div>
      
      <div class="stats" id="gameStats">
        Clicks: 0
      </div>
      
      <div class="status" id="status">
        Initializing...
      </div>
    </div>

    <script type="module">
      import { sdk } from 'https://esm.sh/@farcaster/miniapp-sdk';

      let clickCount = 0;
      const gameButton = document.getElementById('gameButton');
      const gameStats = document.getElementById('gameStats');
      const gameStatus = document.getElementById('gameStatus');
      const sdkStatus = document.getElementById('sdkStatus');
      const status = document.getElementById('status');

      function updateStatus(message) {
        status.textContent = message;
        console.log(message);
      }

      function updateGameStatus(message) {
        gameStatus.textContent = `Status: ${message}`;
      }

      function updateSDKStatus(message) {
        sdkStatus.textContent = `SDK: ${message}`;
      }

      // Game logic
      gameButton.addEventListener('click', () => {
        clickCount++;
        gameStats.textContent = `Clicks: ${clickCount}`;
        updateStatus(`Clicked! Total: ${clickCount}`);
      });

      // Farcaster Mini App initialization (following boop-to-earn exactly)
      const startApp = async () => {
        try {
          updateStatus('Starting Farcaster Mini App...');
          updateSDKStatus('Initializing...');
          
          // Get Ethereum provider (required step)
          updateStatus('Getting Ethereum provider...');
          await sdk.wallet.getEthereumProvider();
          updateStatus('Ethereum provider ready');
          updateSDKStatus('Provider Ready');
          
          // Call sdk.actions.ready() to dismiss splash screen
          updateStatus('Calling sdk.actions.ready()...');
          sdk.actions.ready({ disableNativeGestures: true });
          updateStatus('âœ… sdk.actions.ready() called successfully!');
          updateSDKStatus('Ready Called');
          updateGameStatus('Game Ready!');
          
        } catch (err) {
          console.warn("Initialization error:", err);
          updateStatus(`Error: ${err.message}`);
          updateSDKStatus('Error');
          updateGameStatus('Error');
        }
      };

      // Start the app when page loads
      startApp();
    </script>
  </body>
</html>